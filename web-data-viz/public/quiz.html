<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz de Personalidade - Star Wars</title>
    <link rel="stylesheet" href="../DOCUMENTOS_DE_APOIO/exemplo_de_quiz/style.css">
</head>

<body onload="onloadEsconder()">
    <div id="pontuacaoEJogo">
        <button id="btnIniciarQuiz" onclick="iniciarQuiz()">INICIAR QUIZ</button>

        <div id="pontuacao" class="flex-colunar width-fit-content border-primary">
            
            <div id="pontuacaoDuranteJogo" class="flex-colunar padding-8">
                <span class="width-fit-content">Seu perfil está sendo construído...</span>
            </div>
            
            <div id="pontuacaoFinalJogo" class="flex-colunar padding-8" style="display: none;">
                <span id="pontuacaoFinal" class="width-fit-content text-bold">Pontuações Finais:</span>
                <div id="pontuacoesDetalhadas" class="flex-colunar">
                    </div>
                <hr>
                <span id="msgFinal" class="width-fit-content text-bold">***</span>
            </div>
        </div>

        <div id="jogo" class="width-fit-content flex-colunar border-secondary">

            <div id="infoQuestao" class="padding-8">
                <span>Questão atual: <span id="spanNumeroDaQuestaoAtual"></span> de <span id="qtdQuestoes"></span>
                    questões.</span>
            </div>

            <div id="perguntaDaQuestaoAtual" class="padding-8">
                <span id="spanQuestaoExibida" class="text-bold"></span>
            </div>

            <div id="infoAlternativas" class="padding-8">
                <span><em>Escolha uma opção dentre as abaixo:</em></span>
            </div>

            <div id="opcoes" class="flex-colunar padding-8">
                <span>
                    <input type="radio" id="primeiraOpcao" name="option" class="radio" value="alternativaA" />
                    <label for="primeiraOpcao" class="option" id="labelOpcaoUm"></label>
                </span>
                <span>
                    <input type="radio" id="segundaOpcao" name="option" class="radio" value="alternativaB" />
                    <label for="segundaOpcao" class="option" id="labelOpcaoDois"></label>
                </span>
                <span>
                    <input type="radio" id="terceiraOpcao" name="option" class="radio" value="alternativaC" />
                    <label for="terceiraOpcao" class="option" id="labelOpcaoTres"></label>
                </span>
                <span>
                    <input type="radio" id="quartaOpcao" name="option" class="radio" value="alternativaD" />
                    <label for="quartaOpcao" class="option" id="labelOpcaoQuatro"></label>
                </span>
            </div>

            <div id="botoes" class="flex-colunar padding-8">
                <button onclick="submeter()" id="btnSubmeter">Submeter resposta</button>
                <button onclick="avancar()" id="btnProx" disabled>Avançar para próxima questão</button>
                <button onclick="tentarNovamente()" id="btnTentarNovamente" disabled>Tentar novamente</button>
            </div>

        </div>
    </div>
</body>

</html>

<script>
    // ⭐️ ESTRUTURA DE DADOS COMPLETA (mantida idêntica para o funcionamento)
const listaDeQuestoes = [
    // ... (todas as 10 questões, inalteradas)
    {
        pergunta: "1. Cenário de Perigo Iminente: A Força avisa você de um ataque inimigo em 5 minutos. Como você reage?",
        alternativaA: "Começo a evacuar todos de forma discreta, priorizando a ordem e o sigilo.",
        alternativaB: "Corro para a área de defesa principal e preparo um contra-ataque imediato e total.",
        alternativaC: "Localizo o ponto de origem da ameaça e armo uma emboscada técnica e precisa.",
        alternativaD: "Tento encontrar a fonte do conflito para tentar uma negociação antes do ataque.",
        pontuacoes: {
            alternativaA: { Sabedoria: 2, Coragem: 0, Habilidade: 0, Compaixao: 0, Influencia: 1 },
            alternativaB: { Sabedoria: 0, Coragem: 2, Habilidade: 0, Compaixao: 0, Influencia: -1 },
            alternativaC: { Sabedoria: 0, Coragem: 0, Habilidade: 2, Compaixao: 0, Influencia: 0 },
            alternativaD: { Sabedoria: 0, Coragem: 0, Habilidade: 0, Compaixao: 2, Influencia: 0 }
        }
    },
    // ... (restante das 10 questões omitido por brevidade)
    {
        pergunta: "10. O Que é Liberdade para Você? A verdadeira liberdade na galáxia é...",
        alternativaA: "O conhecimento para entender o universo e a capacidade de ser livre da emoção.",
        alternativaB: "A capacidade de ir para onde quiser e fazer o que for preciso para sobreviver.",
        alternativaC: "Um lugar onde todos possam viver em paz, livres do medo e da opressão.",
        alternativaD: "O poder de ditar suas próprias regras e não se curvar a ninguém.",
        pontuacoes: {
            alternativaA: { Sabedoria: 2, Coragem: 0, Habilidade: 0, Compaixao: 0, Influencia: 0 },
            alternativaB: { Sabedoria: 0, Coragem: 2, Habilidade: 1, Compaixao: 0, Influencia: 0 },
            alternativaC: { Sabedoria: 0, Coragem: 0, Habilidade: 0, Compaixao: 2, Influencia: 1 },
            alternativaD: { Sabedoria: 0, Coragem: 0, Habilidade: 1, Compaixao: 0, Influencia: 2 }
        }
    }
];

// ⭐️ VARIÁVEIS GLOBAIS
let numeroDaQuestaoAtual = 0;
let quantidadeDeQuestoes = listaDeQuestoes.length;

// Variáveis separadas para as pontuações (mantidas)
let pontuacaoSabedoria = 0;
let pontuacaoCoragem = 0;
let pontuacaoHabilidade = 0;
let pontuacaoCompaixao = 0;
let pontuacaoInfluencia = 0;

let idUsuario = sessionStorage.ID_USUARIO


// Funções de UI (onloadEsconder, iniciarQuiz, preencherHTMLcomQuestaoAtual, avancar, tentarNovamente, habilitarAlternativas, desmarcarRadioButtons, limparCoresBackgroundOpcoes)
// ... (Mantidas as mesmas)

function onloadEsconder() {
    document.getElementById('pontuacao').style.display = "none";
    document.getElementById('jogo').style.display = "none";
    document.getElementById('pontuacaoFinalJogo').style.display = "none";
}

function iniciarQuiz() {
    document.getElementById('pontuacao').style.display = "flex";
    document.getElementById('jogo').style.display = "flex";
    document.getElementById('btnIniciarQuiz').style.display = "none";
    document.getElementById('pontuacaoDuranteJogo').style.display = "flex";

    document.getElementById('qtdQuestoes').innerHTML = quantidadeDeQuestoes;
    preencherHTMLcomQuestaoAtual(0);

    btnSubmeter.disabled = false;
    btnProx.disabled = true;
    btnTentarNovamente.disabled = true;
}

function preencherHTMLcomQuestaoAtual(index) {
    habilitarAlternativas(true);
    const questaoAtual = listaDeQuestoes[index];

    if (questaoAtual) {
        numeroDaQuestaoAtual = index;
        document.getElementById("spanNumeroDaQuestaoAtual").innerHTML = Number(index) + 1;
        document.getElementById("spanQuestaoExibida").innerHTML = questaoAtual.pergunta;
        document.getElementById("labelOpcaoUm").innerHTML = questaoAtual.alternativaA;
        document.getElementById("labelOpcaoDois").innerHTML = questaoAtual.alternativaB;
        document.getElementById("labelOpcaoTres").innerHTML = questaoAtual.alternativaC;
        document.getElementById("labelOpcaoQuatro").innerHTML = questaoAtual.alternativaD;
    } else {
        finalizarJogo();
    }
}

function avancar() {
    preencherHTMLcomQuestaoAtual(numeroDaQuestaoAtual);

    btnProx.disabled = true;
    btnSubmeter.disabled = false;
    desmarcarRadioButtons();
    limparCoresBackgroundOpcoes();
}

function tentarNovamente() {
    window.location.reload();
}

function habilitarAlternativas(trueOrFalse) {
    const isEnable = !trueOrFalse;
    document.getElementById('primeiraOpcao').disabled = isEnable;
    document.getElementById('segundaOpcao').disabled = isEnable;
    document.getElementById('terceiraOpcao').disabled = isEnable;
    document.getElementById('quartaOpcao').disabled = isEnable;
}

function desmarcarRadioButtons() {
    const options = document.getElementsByName("option");
    options.forEach(option => option.checked = false);
}

function limparCoresBackgroundOpcoes() {
    const options = document.getElementsByName("option");
    options.forEach(option => {
        if (option.labels.length > 0) {
            option.labels[0].classList.remove("text-new-gray-with-bg");
        }
    });
}


function submeter() {
    const options = document.getElementsByName("option");
    let alternativaEscolhida = null;

    options.forEach((option) => {
        if (option.checked) {
            alternativaEscolhida = option.value;
        }
    });

    if (!alternativaEscolhida) {
        alert("Não há alternativas escolhidas. Escolha uma opção.");
        return;
    }

    numeroDaQuestaoAtual++;
    checarResposta(alternativaEscolhida); 

    btnSubmeter.disabled = true;
    habilitarAlternativas(false);

    if (numeroDaQuestaoAtual < quantidadeDeQuestoes) {
        btnProx.disabled = false;
    } else {
        finalizarJogo();
    }
}


function checarResposta(alternativaEscolhida) {
    const questaoAtual = listaDeQuestoes[numeroDaQuestaoAtual - 1]; 
    const pontuacoesDaResposta = questaoAtual.pontuacoes[alternativaEscolhida];

    if (pontuacoesDaResposta.Sabedoria !== undefined) {
        pontuacaoSabedoria += pontuacoesDaResposta.Sabedoria;
    }
    if (pontuacoesDaResposta.Coragem !== undefined) {
        pontuacaoCoragem += pontuacoesDaResposta.Coragem;
    }
    if (pontuacoesDaResposta.Habilidade !== undefined) {
        pontuacaoHabilidade += pontuacoesDaResposta.Habilidade;
    }
    if (pontuacoesDaResposta.Compaixao !== undefined) {
        pontuacaoCompaixao += pontuacoesDaResposta.Compaixao;
    }
    if (pontuacoesDaResposta.Influencia !== undefined) {
        pontuacaoInfluencia += pontuacoesDaResposta.Influencia;
    }

    const radioInput = document.querySelector(`input[value="${alternativaEscolhida}"]`);
    if (radioInput && radioInput.labels.length > 0) {
        radioInput.labels[0].classList.add("text-new-gray-with-bg");
    }
}

function finalizarJogo() {


    fetch("/pontos/cadastrar", {    
        method: "POST",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify({

            pontuacaoSabedoriaServer: pontuacaoSabedoria,
            pontuacaoCoragemServer: pontuacaoCoragem,
            pontuacaoHabilidadeServer: pontuacaoHabilidade,
            pontuacaoCompaixaoServer: pontuacaoCompaixao,
            pontuacaoInfluenciaServer: pontuacaoInfluencia,
            idUsuarioServer: idUsuario
        }),
    })
    
    .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
          cardErro.style.display = "block";

          mensagem_erro.innerHTML =
            "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

          setTimeout(() => {
            window.location = "login.html";
          }, "2000");

          limparFormulario();
          
        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        
      });
    }


</script>